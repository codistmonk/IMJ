<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="create_imj_jar" name="Create Jar for Project IMJ">
    <!--ANT 1.7 is required                                        -->
    <target name="create_imj_jar">
    	<exec executable="svnversion" output="src/imj/version" logError="true"/>
        <jar destfile="imj-all.jar" filesetmanifest="mergewithoutmain">
            <manifest>
                <attribute name="Class-Path" value="."/>
            </manifest>
            <fileset file="imj_license.txt"/>
            <fileset file="readme.txt"/>
            <fileset dir="bin" excludes="**/*Test*.*">
            	<present present="srconly" targetdir="test"/>
        	</fileset>
            <fileset dir="src"/>
            <fileset dir="." includes="lib/tango/**"/>
            <zipfileset excludes="META-INF/*.SF" src="lib/aprog.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="lib/jgencode.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="lib/bioformats_package.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="lib/commons-compress-1.8.1.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="lib/xstream-1.4.7.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="lib/ojalgo-33.0.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="lib/jsch-0.1.50.jar"/>
            <zipfileset excludes="META-INF/*.SF" src="lib/truezip-7.7.8.jar"/>
        </jar>
        <jar destfile="imj.jar" filesetmanifest="mergewithoutmain">
            <manifest>
                <attribute name="Class-Path" value="."/>
            </manifest>
            <fileset file="imj_license.txt"/>
            <fileset file="readme.txt"/>
            <fileset dir="bin" excludes="**/*Test*.*">
            	<present present="srconly" targetdir="test"/>
        	</fileset>
            <fileset dir="src"/>
            <fileset dir="." includes="lib/tango/**"/>
        </jar>
        <jar destfile="imj3-aprog.jar" filesetmanifest="mergewithoutmain">
            <manifest>
                <attribute name="Class-Path" value="."/>
            </manifest>
            <fileset file="imj_license.txt"/>
            <fileset file="readme.txt"/>
            <fileset dir="bin" includes="imj3/core/**,imj3/tools/**,imj3/protocol/**">
            	<present present="srconly" targetdir="test"/>
        	</fileset>
            <fileset dir="src" includes="imj3/core/**,imj3/tools/**,imj3/protocol/**"/>
            <zipfileset excludes="META-INF/*.SF" src="lib/aprog.jar"/>
        </jar>
        <jar destfile="evaluateclassification.jar" filesetmanifest="mergewithoutmain">
            <manifest>
                <attribute name="Main-Class" value="imj3.draft.EvaluateClassification"/>
                <attribute name="Class-Path" value="."/>
            </manifest>
            <fileset file="imj_license.txt"/>
            <fileset file="readme.txt"/>
            <fileset dir="bin" includes="imj3/draft/EvaluateClassification*">
            	<present present="srconly" targetdir="test"/>
        	</fileset>
            <fileset dir="src" includes="imj3/draft/EvaluateClassification*"/>
            <zipfileset excludes="META-INF/*.SF" src="lib/aprog.jar"/>
        </jar>
    	<delete file="src/imj/version"/>
    </target>
</project>
